<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Registrasi Santri Baru</title>
    <link href='https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css' rel='stylesheet'>
    <link rel="stylesheet" href="login.css">
</head>
<body>
    
    <div class="register-container">
        
        <div class="registrasi-header">
            <h1 class="title">Registrasi Santri Baru</h1>
            <p class="subtitle">
                Isi data berikut untuk mendaftar sebagai santri Yayasan Sahabat Qur'an
            </p>
        </div>

        <form class="register-form" id="registrationForm">
            <div class="input-group">
                <label for="nama_lengkap">Nama Lengkap</label>
                <input type="text" id="nama_lengkap" placeholder="" required autocomplete="off">
            </div>

            <div class="two-forms">
                <div class="input-group half-width">
                    <label for="tempat_lahir">Tempat Lahir</label>
                    <input type="text" id="tempat_lahir" placeholder="" required autocomplete="off">
                </div>
                
                <div class="input-group half-width">
                    <label for="tanggal_lahir">Tanggal Lahir</label>
                    <input type="date" id="tanggal_lahir" required autocomplete="off">
                </div>
            </div>

            <div class="input-group">
                <label for="nomor_telepon">Nomor Telepon</label>
                <input type="tel" id="nomor_telepon" placeholder="" required autocomplete="off">
            </div>

            <div class="input-group">
                <label for="email">Email (untuk login)</label>
                <input type="email" id="email" placeholder="" required autocomplete="off">
            </div>

            <div class="input-group">
                <label for="password">Kata Sandi</label>
                <input type="password" id="password" placeholder="" required autocomplete="off">
            </div>

            <div class="input-group">
                <label for="password_confirm">Konfirmasi Kata Sandi</label>
                <input type="password" id="password_confirm" placeholder="" required autocomplete="off">
            </div>

            <div class="checkbox-group">
                <input type="checkbox" id="syarat_ketentuan" required>
                <label for="syarat_ketentuan">Saya menyetujui Syarat dan Ketentuan yang berlaku.</label>
            </div>
            
            <button type="submit" class="btn daftar-btn">Daftar</button>
        </form>
    </div> 
    
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const form = document.getElementById('registrationForm');

            form.addEventListener('submit', async function(event) {
                event.preventDefault();

                const email = document.getElementById('email').value.trim();
                const password = document.getElementById('password').value;
                const passwordConfirm = document.getElementById('password_confirm').value;

                if (!email || !password) {
                    alert('Email dan kata sandi wajib diisi');
                    return;
                }

                if (password !== passwordConfirm) {
                    alert('Konfirmasi kata sandi tidak sama');
                    return;
                }

                try {
                    const res = await fetch('http://localhost:8080/api/auth/register', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify({ email, password })
                    });

                    const data = await res.json();

                    if (!res.ok) {
                        alert(data.message || 'Registrasi gagal');
                        return;
                    }

                    alert('Registrasi berhasil! Silakan cek informasi selanjutnya.');
                    window.location.href = 'success.html';

                } catch (err) {
                    console.error('Error saat koneksi ke server:', err);
                    alert('Terjadi kesalahan koneksi ke server');
                }
            });
        });
    </script>
</body>
</html>
